var flowchart,xmlhttp=new XMLHttpRequest;xmlhttp.onreadystatechange=function(){4==this.readyState&&200==this.status?(flowchart_obj=JSON.parse(this.responseText),flowchart=flowchart_obj.flowchart,startFlowchart()):flowchart=null},xmlhttp.open("GET","../flowchart_mapping.json",!0),xmlhttp.send();var questionsChosen_arr=[],currentNodeIndex=0,previousNodeIndex=-1,flowchartQuestionEle=document.getElementById("flowchart-question"),flowchartChoicesContainerEle=document.getElementById("flowchart-choices-container"),flowchartBackEle=document.getElementById("back");function startFlowchart(){createChoices(flowchart[0])}function createChoices(e){if(previousNodeIndex=getPreviousIndex(currentNodeIndex),currentNodeIndex=e.head,flowchartChoicesContainerEle.hasChildNodes())for(;flowchartChoicesContainerEle.firstChild;)flowchartChoicesContainerEle.removeChild(flowchartChoicesContainerEle.lastChild);flowchartQuestionEle.innerHTML=e.body;for(var t=0;t<e.tail.length;t++){var r=document.createElement("span");r.setAttribute("class","flowchart-choice"),r.setAttribute("data-choice-index",e.tail[t].tail);var a=document.createTextNode(e.tail[t].fur);r.appendChild(a),r.addEventListener("click",(function(t){var r=getNextNode(t.target.dataset.choiceIndex);questionsChosen_arr.push(e.head),"q"===r.type?createChoices(r):createAnswers(r)})),flowchartChoicesContainerEle.appendChild(r)}}function createAnswers(e){if(previousNodeIndex=getPreviousIndex(currentNodeIndex),currentNodeIndex=e.head,flowchartChoicesContainerEle.hasChildNodes())for(;flowchartChoicesContainerEle.firstChild;)flowchartChoicesContainerEle.removeChild(flowchartChoicesContainerEle.lastChild);flowchartQuestionEle.innerHTML="here are the results";for(var t=0;t<e.tail.length;t++){var r=document.createElement("span");r.setAttribute("class","flowchart-choice"),r.setAttribute("data-answer-title",e.tail[t]);var a=document.createTextNode(e.tail[t]);r.appendChild(a),r.addEventListener("click",(function(t){var r=t.target.dataset.answerTitle;questionsChosen_arr.push(e.head),createResults(r)})),flowchartChoicesContainerEle.appendChild(r)}}function createResults(e){if(flowchartChoicesContainerEle.hasChildNodes())for(;flowchartChoicesContainerEle.firstChild;)flowchartChoicesContainerEle.removeChild(flowchartChoicesContainerEle.lastChild);jikanGetAnime(e),flowchartQuestionEle.innerHTML=e}function getPreviousIndex(e){for(var t=0;t<flowchart.length;t++)for(var r=0;r<flowchart[t].tail.length;r++)if(flowchart[t].tail[r].tail==e)return flowchart[t].head;return-1}function getNextNode(e){for(var t=0;t<flowchart.length;t++)if(flowchart[t].head==e)return flowchart[t];return-1}function jikanGetAnime(e){var t=document.createElement("div");t.setAttribute("class","spinner"),flowchartChoicesContainerEle.append(t),fetch(`https://api.jikan.moe/v3/search/anime?q=${e}&limit=3`).then((function(e){return e.json()})).then((function(t){if(flowchartChoicesContainerEle.hasChildNodes())for(;flowchartChoicesContainerEle.firstChild;)flowchartChoicesContainerEle.removeChild(flowchartChoicesContainerEle.lastChild);for(var r=0;r<t.results.length;r++){var a=document.createElement("div");a.setAttribute("class","anime");var n=document.createElement("a");n.setAttribute("href",t.results[r].url),n.setAttribute("target","_blank"),n.setAttribute("rel","noopener noreferrer"),n.setAttribute("class","anime-link");var o=document.createElement("img");o.setAttribute("src",t.results[r].image_url),o.setAttribute("alt","image of "+e),o.setAttribute("class","anime-image"),n.appendChild(o);var i=document.createElement("h3");i.setAttribute("class","anime-title");var l=document.createTextNode(t.results[r].title);i.appendChild(l),a.appendChild(n),a.appendChild(i),flowchartChoicesContainerEle.append(a)}}))}flowchartBackEle.addEventListener("click",(function(){var e=questionsChosen_arr.pop();if(void 0!==e){var t=getNextNode(e);"q"===t.type?createChoices(t):createAnswers(t)}}));